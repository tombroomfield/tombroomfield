<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>CanIKit | Tom Broomfield</title> <meta name="author" content="Tom Broomfield"> <meta name="description" content="The missing Authorization Library for SvelteKit!"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%91%A8%E2%80%8D%F0%9F%92%BB&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://tombroomfield.com/projects/canikit/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">TomÂ </span>Broomfield</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">CanIKit</h1> <p class="post-description">The missing Authorization Library for SvelteKit!</p> </header> <article> <h4 id="view-canikit-on-github"><a href="https://github.com/tombroomfield/CanIKit" rel="external nofollow noopener" target="_blank">View CanIKit on GitHub</a></h4> <p>CanIKit is a SvelteKit library that provides a simple way to add authorization to your SvelteKit application. It is heavily inspired by <a href="https://github.com/varvet/pundit" rel="external nofollow noopener" target="_blank">Pundit</a>;</p> <p>The main purpose of CanIKit is to provide a simple way to isolate server-side authorization logic from your route files. This allows for a better separation of concerns and helps keep your +server, +layout.server, and +page.server files cleaner.</p> <p>Another key feature of CanIKit is that an error is thrown if the <code class="language-plaintext highlighter-rouge">canI</code> method is not called when running server-side code (typically server page loads or API calls). This helps ensure that authorization is always considered when designing your routes.</p> <h2 id="installation">Installation</h2> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install </span>canikit
</code></pre></div></div> <h2 id="setup">Setup</h2> <p>CanIKit provides a <code class="language-plaintext highlighter-rouge">hook</code> that must be set up in your hooks.server file.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// hooks.server.ts</span>
<span class="k">import</span> <span class="nx">CanIKit</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">canikit</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">handle</span> <span class="o">=</span> <span class="nx">CanIKit</span><span class="p">.</span><span class="nf">handle</span><span class="p">({</span>
  <span class="na">pagePolicies</span><span class="p">:</span> <span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="dl">"</span><span class="s2">./routes/**/page.policy.*</span><span class="dl">"</span><span class="p">),</span>
  <span class="na">pageSevers</span><span class="p">:</span> <span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="dl">"</span><span class="s2">./routes/**/+page.server.*</span><span class="dl">"</span><span class="p">),</span>
  <span class="na">layoutPolicies</span><span class="p">:</span> <span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="dl">"</span><span class="s2">./routes/**/layout.policy.*</span><span class="dl">"</span><span class="p">),</span>
  <span class="na">layoutServers</span><span class="p">:</span> <span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="dl">"</span><span class="s2">./routes/**/+layout.server.*</span><span class="dl">"</span><span class="p">),</span>
  <span class="na">apiServers</span><span class="p">:</span> <span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="dl">"</span><span class="s2">./routes/**/+server.*</span><span class="dl">"</span><span class="p">),</span>
  <span class="na">apiPolicies</span><span class="p">:</span> <span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="dl">"</span><span class="s2">./routes/**/policy.*</span><span class="dl">"</span><span class="p">),</span>
<span class="p">});</span>
</code></pre></div></div> <p>In the likely event that you are already using a hook, simply utilize the SvelteKit <code class="language-plaintext highlighter-rouge">sequence</code> function to combine the hooks.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// hooks.server.ts</span>
<span class="k">import</span> <span class="nx">CanIKit</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">canikit</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">sequence</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@sveltejs/kit/hooks</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">handle</span> <span class="o">=</span> <span class="nf">sequence</span><span class="p">(</span>
  <span class="c1">// ... other hooks,</span>
  <span class="nx">CanIKit</span><span class="p">.</span><span class="nf">handle</span><span class="p">({</span>
    <span class="na">pagePolicies</span><span class="p">:</span> <span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="dl">"</span><span class="s2">./routes/**/page.policy.*</span><span class="dl">"</span><span class="p">),</span>
    <span class="na">pageSevers</span><span class="p">:</span> <span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="dl">"</span><span class="s2">./routes/**/+page.server.*</span><span class="dl">"</span><span class="p">),</span>
    <span class="na">layoutPolicies</span><span class="p">:</span> <span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="dl">"</span><span class="s2">./routes/**/layout.policy.*</span><span class="dl">"</span><span class="p">),</span>
    <span class="na">layoutServers</span><span class="p">:</span> <span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="dl">"</span><span class="s2">./routes/**/+layout.server.*</span><span class="dl">"</span><span class="p">),</span>
    <span class="na">apiServers</span><span class="p">:</span> <span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="dl">"</span><span class="s2">./routes/**/+server.*</span><span class="dl">"</span><span class="p">),</span>
    <span class="na">apiPolicies</span><span class="p">:</span> <span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="dl">"</span><span class="s2">./routes/**/policy.*</span><span class="dl">"</span><span class="p">),</span>
  <span class="p">})</span>
<span class="p">);</span>
</code></pre></div></div> <h2 id="usage">Usage</h2> <p>Once setup, you will likely start getting some errors when you try to load your pages. This is because on every server-side load event, CanIKit will check to ensure that the <code class="language-plaintext highlighter-rouge">canI</code> method is called. Letâs see an example of how we can do that.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// +page.server.js</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nf">load</span><span class="p">({</span> <span class="nx">request</span><span class="p">,</span> <span class="na">locals</span><span class="p">:</span> <span class="p">{</span> <span class="nx">canI</span> <span class="p">}</span> <span class="p">})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// Find the user based on the request</span>
  <span class="k">await</span> <span class="nf">canI</span><span class="p">({</span> <span class="nx">user</span> <span class="p">});</span>


  <span class="c1">// ... other code</span>
<span class="p">}</span>
</code></pre></div></div> <p>In itâs most basic form, the <code class="language-plaintext highlighter-rouge">canI</code> function can be passed a user object. The user will be passed to the policy for the page, layout, or API route. Letâs see an example of a policy file for a page:</p> <p>In the same directory as the <code class="language-plaintext highlighter-rouge">+page.server.js|ts</code> file, create a <code class="language-plaintext highlighter-rouge">page.policy.js|ts</code> file.</p> <p>This very simple policy just checks to ensure that we have a signed in user, otherwise the authorization will fail.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// page.policy.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">CanIKitPolicy</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">canikit</span><span class="dl">"</span><span class="p">;</span>
<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nc">Policy</span> <span class="kd">extends</span> <span class="nc">CanIKit</span> <span class="p">{</span>
  <span class="k">async</span> <span class="nf">view</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// We have access to this user object through this.user</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="authorizing-resources">Authorizing resources</h3> <p>Often, âwho can view this pageâ is not enough. We often need to authorize the page (or action) against a specific resource. Take this page for example</p> <p><code class="language-plaintext highlighter-rouge">./routes/todos/[id]/+page.server.ts</code></p> <p>In this case, we only want to allow the user to view the page if they are the owner of the todo item. We can do this by passing the resource to the <code class="language-plaintext highlighter-rouge">canI</code> method.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// +page.server.ts</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nf">load</span><span class="p">({</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="na">locals</span><span class="p">:</span> <span class="p">{</span> <span class="nx">canI</span> <span class="p">}</span> <span class="p">})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// Find the user based on the request</span>
  <span class="kd">const</span> <span class="nx">todo</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// Find the todo based on the params</span>
  <span class="k">await</span> <span class="nf">canI</span><span class="p">({</span> <span class="nx">user</span><span class="p">,</span> <span class="na">resource</span><span class="p">:</span> <span class="nx">todo</span> <span class="p">});</span>

  <span class="c1">// ... other code</span>
<span class="p">}</span>

</code></pre></div></div> <p>Then, inside our policy file:</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// page.policy.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">CanIKitPolicy</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">canikit</span><span class="dl">"</span><span class="p">;</span>
<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nc">Policy</span> <span class="kd">extends</span> <span class="nc">CanIKit</span> <span class="p">{</span>
  <span class="k">async</span> <span class="nf">view</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// We have access to this user object through this.user</span>
    <span class="c1">// We have access to the resource through this.resource</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

    <span class="c1">// We only want to allow the user to view the page if they are the owner of the todo item</span>
    <span class="k">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">resource</span><span class="p">.</span><span class="nx">userId</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="authorizing-actions">Authorizing actions</h3> <p>So far, weâve only added âviewâ actions to our policy. This is the default action that is called when the request is a GET request, such as when loading a page. When weâre doing <em>POST</em>, <em>PUT</em>, OR <em>DELETE</em> requests, the action will be <em>âcreateâ</em>, <em>âupdateâ</em>, and <em>âdeleteâ</em> respectively.</p> <p>You can override the default action by passing it as an option to the <code class="language-plaintext highlighter-rouge">canI</code> method.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// +page.server.ts</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nf">load</span><span class="p">({</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="na">locals</span><span class="p">:</span> <span class="p">{</span> <span class="nx">canI</span> <span class="p">}</span> <span class="p">})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// Find the user based on the request</span>
  <span class="kd">const</span> <span class="nx">todo</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// Find the todo based on the params</span>
  <span class="k">await</span> <span class="nf">canI</span><span class="p">({</span> <span class="nx">user</span><span class="p">,</span> <span class="na">resource</span><span class="p">:</span> <span class="nx">todo</span><span class="p">,</span> <span class="na">action</span><span class="p">:</span> <span class="dl">"</span><span class="s2">update</span><span class="dl">"</span> <span class="p">});</span>

  <span class="c1">// ... other code</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="custom-actions">Custom actions</h4> <p>Feel free to add your own custom actions. For example, you may want to add a âcompleteâ action to the todo item policy.</p> <h3 id="understanding-policy-load-order">Understanding policy load order</h3> <p>There are a few rules to keep in when designing your policies:</p> <ul> <li> <p>CanIKit expects a policy file to be in the same directory as the server file. For example, if you have a <code class="language-plaintext highlighter-rouge">+page.server.ts</code> file, CanIKit will look for a <code class="language-plaintext highlighter-rouge">page.policy.ts</code> file in the same directory. If you have a <code class="language-plaintext highlighter-rouge">+layout.server.ts</code> file, CanIKit will look for a <code class="language-plaintext highlighter-rouge">layout.policy.ts</code> file in the same directory and if you have a <code class="language-plaintext highlighter-rouge">+server.ts</code> file, CanIKit will look for a <code class="language-plaintext highlighter-rouge">policy.ts</code> file in the same directory.</p> </li> <li> <p>You must have a policy file for each server file unless you skip authorization in the server file.</p> </li> <li> <p>When you render a page, all of the layout policies which are <em>ancestors</em> to the page will be called first, with the page policy being called last.</p> </li> </ul> <p>For example:</p> <p><img src="./docs/images/load_order.png" alt="Policy load order"></p> <p>In this case, when the bars page is rendered, the root layout policy will be called first, then the foos layout policy, then the bars layout policy (if it exists), and finally the bars page policy.</p> <p><strong>All policies must pass for the page to be rendered.</strong></p> <p><strong>IMPORTANT:</strong> It is strongly recommended that you do not call <code class="language-plaintext highlighter-rouge">canI</code> from layout files. Always call <code class="language-plaintext highlighter-rouge">canI</code> from the page or API route file. Itâs great to add a layout policy to nest specific checks, but calling <code class="language-plaintext highlighter-rouge">canI</code> from the layout file will open up the risk of accidently skipping authorization in the page file. In this case, there missing authorization error will not be thrown.</p> <h3 id="skipping-authorization">Skipping authorization</h3> <p>Sometimes, you may want to skip authorization for a page. For example, you may have a public page that anyone can view. You can do this by calling the skipCanI method.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// +page.server.ts</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nf">load</span><span class="p">({</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="na">locals</span><span class="p">:</span> <span class="p">{</span> <span class="nx">skipCanI</span> <span class="p">}</span> <span class="p">})</span> <span class="p">{</span>
  <span class="nf">skipCanI</span><span class="p">();</span>

  <span class="c1">// ... other code</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="using-custom-policies">Using custom policies</h3> <p>You can pass a different policy to the <code class="language-plaintext highlighter-rouge">canI</code> method if you want to use a custom or different policy. For example, you may want to use a different policy for a specific page.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">MyOtherPolicy</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// Import your custom policy</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nf">load</span><span class="p">({</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="na">locals</span><span class="p">:</span> <span class="p">{</span> <span class="nx">canI</span> <span class="p">}</span> <span class="p">})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// Find the user based on the request</span>
  <span class="kd">const</span> <span class="nx">todo</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// Find the todo based on the params</span>
  <span class="k">await</span> <span class="nf">canI</span><span class="p">({</span> <span class="nx">user</span><span class="p">,</span> <span class="na">resource</span><span class="p">:</span> <span class="nx">todo</span><span class="p">,</span> <span class="na">policy</span><span class="p">:</span> <span class="nx">MyOtherPolicy</span> <span class="p">});</span>

  <span class="c1">// ... other code</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>Note:</strong> Ancestor layout policies will still be called before the custom policy.</p> <h3 id="using-policies-outside-of-the-loadgetpostputdelete-functions">Using policies outside of the load/get/post/put/delete functions:</h3> <p>Sometimes, you may want to use the policy outside of the load/get/post/put/delete functions. You can do this by importing the policy directly.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">Policy</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./page.policy</span><span class="dl">"</span><span class="p">;</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nf">someFunction</span><span class="p">({</span> <span class="nx">user</span><span class="p">,</span> <span class="nx">resource</span> <span class="p">})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">policy</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Policy</span><span class="p">({</span> <span class="nx">user</span><span class="p">,</span> <span class="nx">resource</span> <span class="p">});</span>
  <span class="kd">const</span> <span class="nx">canView</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">policy</span><span class="p">.</span><span class="nf">view</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> Â© Copyright 2023 Tom Broomfield. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>